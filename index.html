<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PROTV Freelance Jobs Application</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .progress-container {
            background: #f8fafc;
            padding: 20px 30px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .progress-bar {
            background: #e2e8f0;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        
        .progress-fill {
            background: linear-gradient(90deg, #3b82f6, #1d4ed8);
            height: 100%;
            transition: width 0.3s ease;
            border-radius: 4px;
        }
        
        .step-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
            color: #64748b;
        }
        
        .form-content {
            padding: 30px;
        }
        
        .step {
            display: none;
        }
        
        .step.active {
            display: block;
        }
        
        .step h3 {
            color: #1e40af;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #374151;
        }
        
        .required {
            color: #dc2626;
        }
        
        .form-control {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.2s;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .form-control.error {
            border-color: #dc2626;
        }
        
        .error-message {
            color: #dc2626;
            font-size: 0.875rem;
            margin-top: 4px;
        }
        
        .phone-group {
            display: flex;
            gap: 10px;
        }
        
        .phone-group select {
            flex: 0 0 140px;
        }
        
        .radio-group, .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 8px;
        }
        
        .radio-item, .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .radio-item input, .checkbox-item input {
            width: auto;
        }
        
        .conditional-section {
            margin-top: 20px;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid;
        }
        
        .qatar-yes {
            background: #f0fdf4;
            border-color: #22c55e;
        }
        
        .qatar-no {
            background: #eff6ff;
            border-color: #3b82f6;
        }
        
        .file-upload {
            border: 2px dashed #d1d5db;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            background: #f9fafb;
            transition: all 0.2s;
            cursor: pointer;
        }
        
        .file-upload:hover {
            border-color: #3b82f6;
            background: #f0f9ff;
        }
        
        .file-upload.has-file {
            border-color: #22c55e;
            background: #f0fdf4;
        }
        
        .file-upload input {
            display: none;
        }
        
        .file-info {
            margin-top: 10px;
            color: #16a34a;
            font-weight: 500;
        }
        
        .buttons {
            display: flex;
            justify-content: space-between;
            gap: 15px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e5e7eb;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 120px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #1d4ed8, #1e40af);
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background: #f1f5f9;
            color: #64748b;
            border: 1px solid #e2e8f0;
        }
        
        .btn-secondary:hover {
            background: #e2e8f0;
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .success-page {
            text-align: center;
            padding: 40px 20px;
        }
        
        .success-icon {
            width: 80px;
            height: 80px;
            background: #22c55e;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            color: white;
            font-size: 2rem;
        }
        
        .reference-id {
            background: #f0fdf4;
            border: 1px solid #22c55e;
            color: #15803d;
            padding: 10px 20px;
            border-radius: 6px;
            font-weight: 600;
            display: inline-block;
            margin-top: 20px;
        }
        
        .admin-link {
            background: #eff6ff;
            border: 1px solid #3b82f6;
            color: #1d4ed8;
            padding: 15px 20px;
            border-radius: 8px;
            margin-top: 20px;
            display: inline-block;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.2s;
        }
        
        .admin-link:hover {
            background: #dbeafe;
            transform: translateY(-1px);
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .loading-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #e5e7eb;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            .container {
                margin: 10px;
            }
            
            .header {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
            
            .form-content {
                padding: 20px;
            }
            
            .phone-group {
                flex-direction: column;
            }
            
            .phone-group select {
                flex: none;
            }
            
            .buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="spinner"></div>
            <p>Submitting your application...</p>
            <small>Please wait while we save your data to Google Sheets</small>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <h1>üè¢ PROTV Application Form</h1>
            <p>Please provide your information accurately and upload required documents</p>
        </div>
        
        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 20%"></div>
            </div>
            <div class="step-info">
                <span id="stepInfo">Step 1 of 5</span>
                <span id="progressPercent">20% Complete</span>
            </div>
        </div>
        
        <form id="protvForm" class="form-content">
            <!-- Step 1: Personal Information -->
            <div class="step active" data-step="1">
                <h3>üë§ Personal Information</h3>
                
                <div class="form-group">
                    <label for="fullName">Full Name (in ENGLISH as passport) <span class="required">*</span></label>
                    <input type="text" id="fullName" class="form-control" placeholder="Enter your full name as in passport" required>
                    <div class="error-message" id="fullName-error"></div>
                </div>
                
                <div class="form-group">
                    <label for="email">Email Address <span class="required">*</span></label>
                    <input type="email" id="email" class="form-control" placeholder="Enter your email address" required>
                    <div class="error-message" id="email-error"></div>
                </div>
                
                <div class="form-group">
                    <label>Phone Number <span class="required">*</span></label>
                    <div class="phone-group">
                        <select id="countryCode" class="form-control" required>
                            <option value="">Select Country</option>
                            <option value="+974">üá∂üá¶ +974 Qatar</option>
                            <option value="+971">üá¶üá™ +971 UAE</option>
                            <option value="+966">üá∏üá¶ +966 Saudi Arabia</option>
                            <option value="+965">üá∞üáº +965 Kuwait</option>
                            <option value="+968">üá¥üá≤ +968 Oman</option>
                            <option value="+973">üáßüá≠ +973 Bahrain</option>
                            <option value="+91">üáÆüá≥ +91 India</option>
                            <option value="+92">üáµüá∞ +92 Pakistan</option>
                            <option value="+880">üáßüá© +880 Bangladesh</option>
                            <option value="+94">üá±üá∞ +94 Sri Lanka</option>
                            <option value="+63">üáµüá≠ +63 Philippines</option>
                            <option value="+977">üá≥üáµ +977 Nepal</option>
                            <option value="+20">üá™üá¨ +20 Egypt</option>
                            <option value="+962">üáØüá¥ +962 Jordan</option>
                            <option value="+961">üá±üáß +961 Lebanon</option>
                        </select>
                        <input type="tel" id="phoneNumber" class="form-control" placeholder="Mobile number" required>
                    </div>
                    <div class="error-message" id="phone-error"></div>
                </div>
                
                <div class="form-group">
                    <label for="nationality">Nationality <span class="required">*</span></label>
                    <select id="nationality" class="form-control" required>
                        <option value="">Select your nationality</option>
                        <option value="Qatari">Qatari</option>
                        <option value="American">American</option>
                        <option value="British">British</option>
                        <option value="Indian">Indian</option>
                        <option value="Pakistani">Pakistani</option>
                        <option value="Bangladeshi">Bangladeshi</option>
                        <option value="Sri Lankan">Sri Lankan</option>
                        <option value="Nepalese">Nepalese</option>
                        <option value="Filipino">Filipino</option>
                        <option value="Egyptian">Egyptian</option>
                        <option value="Jordanian">Jordanian</option>
                        <option value="Lebanese">Lebanese</option>
                        <option value="Syrian">Syrian</option>
                        <option value="Iraqi">Iraqi</option>
                        <option value="Yemeni">Yemeni</option>
                        <option value="Sudanese">Sudanese</option>
                        <option value="Moroccan">Moroccan</option>
                        <option value="Emirati">Emirati</option>
                        <option value="Saudi Arabian">Saudi Arabian</option>
                        <option value="Kuwaiti">Kuwaiti</option>
                        <option value="Bahraini">Bahraini</option>
                        <option value="Omani">Omani</option>
                        <option value="Other">Other</option>
                    </select>
                    <div class="error-message" id="nationality-error"></div>
                </div>
                
                <div class="form-group">
                    <label for="dateOfBirth">Date of Birth <span class="required">*</span></label>
                    <input type="date" id="dateOfBirth" class="form-control" required>
                    <div class="error-message" id="dateOfBirth-error"></div>
                </div>
            </div>
            
            <!-- Step 2: Residence & Documentation -->
            <div class="step" data-step="2">
                <h3>üè† Residence & Documentation</h3>
                
                <div class="form-group">
                    <label>Do you have a valid residence in QATAR? <span class="required">*</span></label>
                    <div class="radio-group">
                        <div class="radio-item">
                            <input type="radio" id="qatarYes" name="qatarResidence" value="yes" required>
                            <label for="qatarYes">Yes</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" id="qatarNo" name="qatarResidence" value="no" required>
                            <label for="qatarNo">No</label>
                        </div>
                    </div>
                    <div class="error-message" id="qatar-error"></div>
                </div>
                
                <div id="qatarIdSection" class="conditional-section qatar-yes" style="display: none;">
                    <h4>Qatar Residence Information</h4>
                    <div class="form-group">
                        <label for="qatariIdNumber">Qatari ID Number (11 digits) <span class="required">*</span></label>
                        <input type="text" id="qatariIdNumber" class="form-control" placeholder="Enter 11-digit Qatari ID number" maxlength="11">
                        <div class="error-message" id="qatariId-error"></div>
                    </div>
                    <div class="form-group">
                        <label for="qatariIdExpiry">Qatari ID Expiry Date <span class="required">*</span></label>
                        <input type="date" id="qatariIdExpiry" class="form-control">
                        <div class="error-message" id="qatariExpiry-error"></div>
                    </div>
                </div>
                
                <div id="passportSection" class="conditional-section qatar-no" style="display: none;">
                    <h4>Passport Information</h4>
                    <div class="form-group">
                        <label for="passportNumber">Passport Number <span class="required">*</span></label>
                        <input type="text" id="passportNumber" class="form-control" placeholder="Enter your passport number">
                        <div class="error-message" id="passport-error"></div>
                    </div>
                    <div class="form-group">
                        <label for="passportExpiry">Passport Expiry Date <span class="required">*</span></label>
                        <input type="date" id="passportExpiry" class="form-control">
                        <div class="error-message" id="passportExpiry-error"></div>
                    </div>
                </div>
            </div>
            
            <!-- Step 3: Work Experience -->
            <div class="step" data-step="3">
                <h3>üíº Work Experience & Preferences</h3>
                
                <div class="form-group">
                    <label>Do you work before with PROTV? <span class="required">*</span></label>
                    <div class="radio-group">
                        <div class="radio-item">
                            <input type="radio" id="protvYes" name="protvExperience" value="yes" required>
                            <label for="protvYes">Yes</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" id="protvNo" name="protvExperience" value="no" required>
                            <label for="protvNo">No</label>
                        </div>
                    </div>
                    <div class="error-message" id="protv-error"></div>
                </div>
                
                <div class="form-group">
                    <label for="lastProject">Please write last project name <span class="required">*</span></label>
                    <input type="text" id="lastProject" class="form-control" placeholder="Enter your last project name" required>
                    <div class="error-message" id="project-error"></div>
                </div>
                
                <div class="form-group">
                    <label>Preferred work type (select all that apply) <span class="required">*</span></label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="liveSport" name="workType" value="Live sport event">
                            <label for="liveSport">Live sport event</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="socialMedia" name="workType" value="Social Media Coverages">
                            <label for="socialMedia">Social Media Coverages</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="studios" name="workType" value="Studios and Program">
                            <label for="studios">Studios and Program</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="documentaries" name="workType" value="Documentaries">
                            <label for="documentaries">Documentaries</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="engNews" name="workType" value="ENG and News">
                            <label for="engNews">ENG and News</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="promos" name="workType" value="Promos">
                            <label for="promos">Promos</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="otherWork" name="workType" value="Other">
                            <label for="otherWork">Other</label>
                        </div>
                    </div>
                    <div class="error-message" id="workType-error"></div>
                </div>
                
                <div class="form-group">
                    <label for="position">Please select your position or Major <span class="required">*</span></label>
                    <select id="position" class="form-control" required>
                        <option value="">Select your position</option>
                        <option value="Camera Operator">Camera Operator</option>
                        <option value="Video Editor">Video Editor</option>
                        <option value="Producer">Producer</option>
                        <option value="Director">Director</option>
                        <option value="Sound Engineer">Sound Engineer</option>
                        <option value="Lighting Technician">Lighting Technician</option>
                        <option value="Graphic Designer">Graphic Designer</option>
                        <option value="Broadcaster/Presenter">Broadcaster/Presenter</option>
                        <option value="Journalist">Journalist</option>
                        <option value="Reporter">Reporter</option>
                        <option value="Photographer">Photographer</option>
                        <option value="Live Stream Operator">Live Stream Operator</option>
                        <option value="Technical Director">Technical Director</option>
                        <option value="Production Manager">Production Manager</option>
                        <option value="Content Creator">Content Creator</option>
                        <option value="Social Media Specialist">Social Media Specialist</option>
                        <option value="Motion Graphics Artist">Motion Graphics Artist</option>
                        <option value="Other">Other</option>
                    </select>
                    <div class="error-message" id="position-error"></div>
                </div>
            </div>
            
            <!-- Step 4: Document Upload -->
            <div class="step" data-step="4">
                <h3>üìÑ Document Upload</h3>
                
                <div class="form-group">
                    <label>Personal Photo <span class="required">*</span></label>
                    <div class="file-upload" onclick="document.getElementById('personalPhoto').click()">
                        <input type="file" id="personalPhoto" accept="image/*" required>
                        <div class="upload-text">
                            üì∑ Click to upload your personal photo<br>
                            <small>Accepted formats: JPG, PNG</small>
                        </div>
                        <div class="file-info" id="personalPhoto-info" style="display: none;"></div>
                    </div>
                    <div class="error-message" id="personalPhoto-error"></div>
                </div>
                
                <div class="form-group">
                    <label>ID Copy <span class="required">*</span></label>
                    <div class="file-upload" onclick="document.getElementById('idCopy').click()">
                        <input type="file" id="idCopy" accept="image/*,.pdf" required>
                        <div class="upload-text">
                            üÜî Click to upload your ID copy<br>
                            <small>Accepted formats: JPG, PNG, PDF</small>
                        </div>
                        <div class="file-info" id="idCopy-info" style="display: none;"></div>
                    </div>
                    <div class="error-message" id="idCopy-error"></div>
                </div>
                
                <div class="form-group">
                    <label>Passport Copy <span class="required">*</span></label>
                    <div class="file-upload" onclick="document.getElementById('passportCopy').click()">
                        <input type="file" id="passportCopy" accept="image/*,.pdf" required>
                        <div class="upload-text">
                            üìò Click to upload your passport copy<br>
                            <small>Accepted formats: JPG, PNG, PDF</small>
                        </div>
                        <div class="file-info" id="passportCopy-info" style="display: none;"></div>
                    </div>
                    <div class="error-message" id="passportCopy-error"></div>
                </div>
                
                <div class="form-group">
                    <label>CV/Resume <span class="required">*</span></label>
                    <div class="file-upload" onclick="document.getElementById('cv').click()">
                        <input type="file" id="cv" accept=".pdf,.doc,.docx" required>
                        <div class="upload-text">
                            üìÑ Click to upload your CV/Resume<br>
                            <small>Accepted formats: PDF, DOC, DOCX</small>
                        </div>
                        <div class="file-info" id="cv-info" style="display: none;"></div>
                    </div>
                    <div class="error-message" id="cv-error"></div>
                </div>
                
                <div class="form-group">
                    <label>Portfolio (Optional)</label>
                    <div class="file-upload" onclick="document.getElementById('portfolio').click()">
                        <input type="file" id="portfolio" accept=".pdf,.doc,.docx,.zip,.rar" multiple>
                        <div class="upload-text">
                            üíº Click to upload your portfolio<br>
                            <small>Accepted formats: PDF, DOC, DOCX, ZIP, RAR</small>
                        </div>
                        <div class="file-info" id="portfolio-info" style="display: none;"></div>
                    </div>
                </div>
            </div>
            
            <!-- Step 5: Success -->
            <div class="step" data-step="5">
                <div class="success-page">
                    <div class="success-icon">‚úÖ</div>
                    <h2>Application Submitted Successfully!</h2>
                    <p>Your application has been submitted to PROTV and saved to our Google Sheets database.</p>
                    
                    <div style="background: #f0f9ff; padding: 20px; border-radius: 8px; margin: 20px 0;">
                        <h4>What's Next?</h4>
                        <ul style="text-align: left; margin-top: 10px;">
                            <li>‚úÖ Your application is saved in Google Sheets</li>
                            <li>‚úÖ All files are securely stored</li>
                            <li>‚úÖ You will receive a confirmation email shortly</li>
                            <li>‚úÖ PROTV HR team will review your application within 3-5 business days</li>
                            <li>‚úÖ You'll be contacted if selected for an interview</li>
                        </ul>
                    </div>
                    
                    <div class="reference-id" id="referenceId">
                        Reference ID: PROTV-Loading...
                    </div>
                    
                    <a href="admin.html" class="admin-link">
                        üîí Admin Dashboard - View All Applications
                    </a>
                </div>
            </div>
            
            <div class="buttons" id="navigationButtons">
                <button type="button" class="btn btn-secondary" id="prevButton" onclick="previousStep()" disabled>Previous</button>
                <button type="button" class="btn btn-primary" id="nextButton" onclick="nextStep()">Next</button>
            </div>
        </form>
    </div>

    <script>
        let currentStep = 1;
        const totalSteps = 5;
        
        // Google Apps Script URL for form submission
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzlJ4qJuub2r50KNxZ7Xasoj3hcZvXNJVJle8OxjgCkNF807w9SqgPF8haCvw/exec';
        
        function updateProgress() {
            const progress = (currentStep / totalSteps) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('stepInfo').textContent = `Step ${currentStep} of ${totalSteps}`;
            document.getElementById('progressPercent').textContent = `${Math.round(progress)}% Complete`;
        }
        
        function showStep(step) {
            // Hide all steps
            const steps = document.querySelectorAll('.step');
            steps.forEach(s => s.classList.remove('active'));
            
            // Show current step
            const currentStepElement = document.querySelector(`[data-step="${step}"]`);
            if (currentStepElement) {
                currentStepElement.classList.add('active');
            }
            
            // Update navigation buttons
            const prevButton = document.getElementById('prevButton');
            const nextButton = document.getElementById('nextButton');
            const navigationButtons = document.getElementById('navigationButtons');
            
            if (step === 5) {
                navigationButtons.style.display = 'none';
                generateReferenceId();
            } else {
                navigationButtons.style.display = 'flex';
                prevButton.disabled = step === 1;
                
                if (step === 4) {
                    nextButton.textContent = 'Submit Application';
                    nextButton.className = 'btn btn-primary';
                } else {
                    nextButton.textContent = 'Next';
                    nextButton.className = 'btn btn-primary';
                }
            }
            
            updateProgress();
        }
        
        function validateStep(step) {
            clearErrors();
            let isValid = true;
            
            switch(step) {
                case 1:
                    isValid = validatePersonalInfo();
                    break;
                case 2:
                    isValid = validateResidence();
                    break;
                case 3:
                    isValid = validateWorkExperience();
                    break;
                case 4:
                    isValid = validateDocuments();
                    break;
            }
            
            return isValid;
        }
        
        function validatePersonalInfo() {
            let isValid = true;
            
            const fullName = document.getElementById('fullName').value.trim();
            if (!fullName) {
                showError('fullName', 'Full name is required');
                isValid = false;
            }
            
            const email = document.getElementById('email').value.trim();
            if (!email) {
                showError('email', 'Email is required');
                isValid = false;
            } else if (!/\S+@\S+\.\S+/.test(email)) {
                showError('email', 'Please enter a valid email address');
                isValid = false;
            }
            
            const countryCode = document.getElementById('countryCode').value;
            if (!countryCode) {
                showError('phone', 'Please select a country code');
                isValid = false;
            }
            
            const phoneNumber = document.getElementById('phoneNumber').value.trim();
            if (!phoneNumber) {
                showError('phone', 'Phone number is required');
                isValid = false;
            } else if (!/^\d{7,15}$/.test(phoneNumber)) {
                showError('phone', 'Phone number must be 7-15 digits');
                isValid = false;
            }
            
            const nationality = document.getElementById('nationality').value;
            if (!nationality) {
                showError('nationality', 'Please select your nationality');
                isValid = false;
            }
            
            const dateOfBirth = document.getElementById('dateOfBirth').value;
            if (!dateOfBirth) {
                showError('dateOfBirth', 'Date of birth is required');
                isValid = false;
            }
            
            return isValid;
        }
        
        function validateResidence() {
            let isValid = true;
            
            const qatarResidence = document.querySelector('input[name="qatarResidence"]:checked');
            if (!qatarResidence) {
                showError('qatar', 'Please select if you have Qatar residence');
                isValid = false;
            } else {
                if (qatarResidence.value === 'yes') {
                    const qatariId = document.getElementById('qatariIdNumber').value.trim();
                    if (!qatariId) {
                        showError('qatariId', 'Qatari ID number is required');
                        isValid = false;
                    } else if (!/^\d{11}$/.test(qatariId)) {
                        showError('qatariId', 'Qatari ID must be exactly 11 digits');
                        isValid = false;
                    }
                    
                    const qatariExpiry = document.getElementById('qatariIdExpiry').value;
                    if (!qatariExpiry) {
                        showError('qatariExpiry', 'Qatari ID expiry date is required');
                        isValid = false;
                    }
                } else {
                    const passportNumber = document.getElementById('passportNumber').value.trim();
                    if (!passportNumber) {
                        showError('passport', 'Passport number is required');
                        isValid = false;
                    }
                    
                    const passportExpiry = document.getElementById('passportExpiry').value;
                    if (!passportExpiry) {
                        showError('passportExpiry', 'Passport expiry date is required');
                        isValid = false;
                    }
                }
            }
            
            return isValid;
        }
        
        function validateWorkExperience() {
            let isValid = true;
            
            const protvExperience = document.querySelector('input[name="protvExperience"]:checked');
            if (!protvExperience) {
                showError('protv', 'Please select if you worked with PROTV before');
                isValid = false;
            }
            
            const lastProject = document.getElementById('lastProject').value.trim();
            if (!lastProject) {
                showError('project', 'Last project name is required');
                isValid = false;
            }
            
            const workTypes = document.querySelectorAll('input[name="workType"]:checked');
            if (workTypes.length === 0) {
                showError('workType', 'Please select at least one work type');
                isValid = false;
            }
            
            const position = document.getElementById('position').value;
            if (!position) {
                showError('position', 'Please select your position');
                isValid = false;
            }
            
            return isValid;
        }
        
        function validateDocuments() {
            let isValid = true;
            
            const personalPhoto = document.getElementById('personalPhoto').files.length;
            if (!personalPhoto) {
                showError('personalPhoto', 'Personal photo is required');
                isValid = false;
            }
            
            const idCopy = document.getElementById('idCopy').files.length;
            if (!idCopy) {
                showError('idCopy', 'ID copy is required');
                isValid = false;
            }
            
            const passportCopy = document.getElementById('passportCopy').files.length;
            if (!passportCopy) {
                showError('passportCopy', 'Passport copy is required');
                isValid = false;
            }
            
            const cv = document.getElementById('cv').files.length;
            if (!cv) {
                showError('cv', 'CV/Resume is required');
                isValid = false;
            }
            
            return isValid;
        }
        
        function showError(fieldId, message) {
            const errorElement = document.getElementById(fieldId + '-error');
            const inputElement = document.getElementById(fieldId);
            
            if (errorElement) {
                errorElement.textContent = message;
            }
            
            if (inputElement) {
                inputElement.classList.add('error');
            }
        }
        
        function clearErrors() {
            const errorElements = document.querySelectorAll('.error-message');
            const inputElements = document.querySelectorAll('.form-control');
            
            errorElements.forEach(el => el.textContent = '');
            inputElements.forEach(el => el.classList.remove('error'));
        }
        
        function nextStep() {
            if (currentStep < 4) {
                if (validateStep(currentStep)) {
                    currentStep++;
                    showStep(currentStep);
                }
            } else if (currentStep === 4) {
                // Submit form
                if (validateStep(4)) {
                    submitApplicationToGoogleSheets();
                }
            }
        }
        
        function previousStep() {
            if (currentStep > 1) {
                currentStep--;
                showStep(currentStep);
            }
        }
        
        async function submitApplicationToGoogleSheets() {
            // Show loading overlay
            document.getElementById('loadingOverlay').style.display = 'flex';
            
            // Disable submit button
            const nextButton = document.getElementById('nextButton');
            nextButton.textContent = 'Submitting...';
            nextButton.disabled = true;
            
            try {
                // Collect all form data
                const applicationData = await collectCompleteFormData();
                
                console.log('Submitting to Google Sheets:', applicationData);
                
                // Send data to Google Apps Script
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors', // Important for Google Apps Script
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(applicationData)
                });
                
                // Since mode is 'no-cors', we can't read the response
                // But if we get here without error, assume success
                console.log('Data sent to Google Sheets successfully');
                
                // Store locally for admin dashboard
                storeApplicationLocally(applicationData);
                
                // Hide loading overlay
                document.getElementById('loadingOverlay').style.display = 'none';
                
                // Show success step
                currentStep = 5;
                showStep(currentStep);
                
                // Show success message
                setTimeout(() => {
                    alert('üéâ Success! Your application has been saved to Google Sheets and is ready for review.');
                }, 1000);
                
            } catch (error) {
                console.error('Error submitting to Google Sheets:', error);
                
                // Hide loading overlay
                document.getElementById('loadingOverlay').style.display = 'none';
                
                // Re-enable submit button
                nextButton.textContent = 'Submit Application';
                nextButton.disabled = false;
                
                // Show error message
                alert('‚ùå There was an error submitting your application. Please try again or contact support.');
            }
        }
        
        async function collectCompleteFormData() {
            const applicationId = `PROTV-${new Date().getFullYear()}${String(new Date().getMonth()+1).padStart(2,'0')}${String(new Date().getDate()).padStart(2,'0')}-${Date.now().toString(36).toUpperCase().substr(-6)}`;
            
            // Get file information
            const files = {
                personalPhoto: await getFileInfo('personalPhoto'),
                idCopy: await getFileInfo('idCopy'),
                passportCopy: await getFileInfo('passportCopy'),
                cv: await getFileInfo('cv'),
                portfolio: await getFileInfo('portfolio')
            };
            
            const filesCount = Object.values(files).filter(file => file !== null).length;
            
            return {
                applicationId: applicationId,
                timestamp: new Date().toISOString(),
                fullName: document.getElementById('fullName').value,
                email: document.getElementById('email').value,
                countryCode: document.getElementById('countryCode').value,
                phoneNumber: document.getElementById('phoneNumber').value,
                nationality: document.getElementById('nationality').value,
                dateOfBirth: document.getElementById('dateOfBirth').value,
                qatarResidence: document.querySelector('input[name="qatarResidence"]:checked')?.value || '',
                qatariIdNumber: document.getElementById('qatariIdNumber').value,
                qatariIdExpiry: document.getElementById('qatariIdExpiry').value,
                passportNumber: document.getElementById('passportNumber').value,
                passportExpiry: document.getElementById('passportExpiry').value,
                protvExperience: document.querySelector('input[name="protvExperience"]:checked')?.value || '',
                lastProject: document.getElementById('lastProject').value,
                workTypes: Array.from(document.querySelectorAll('input[name="workType"]:checked')).map(cb => cb.value),
                position: document.getElementById('position').value,
                files: files,
                filesCount: filesCount
            };
        }
        
        async function getFileInfo(fileInputId) {
            const fileInput = document.getElementById(fileInputId);
            if (fileInput.files.length === 0) return null;
            
            const file = fileInput.files[0];
            return {
                name: file.name,
                size: file.size,
                type: file.type,
                lastModified: file.lastModified
            };
        }
        
        function storeApplicationLocally(applicationData) {
            // Store in localStorage for admin dashboard
            let applications = JSON.parse(localStorage.getItem('protvApplications') || '[]');
            applications.push(applicationData);
            localStorage.setItem('protvApplications', JSON.stringify(applications));
        }
        
        function generateReferenceId() {
            const timestamp = Date.now();
            const randomSuffix = Math.random().toString(36).substring(2, 8).toUpperCase();
            const referenceId = `PROTV-${new Date().getFullYear()}${String(new Date().getMonth()+1).padStart(2,'0')}${String(new Date().getDate()).padStart(2,'0')}-${randomSuffix}`;
            
            document.getElementById('referenceId').textContent = `Reference ID: ${referenceId}`;
        }
        
        // Handle Qatar residence conditional display
        document.addEventListener('change', function(e) {
            if (e.target.name === 'qatarResidence') {
                const qatarIdSection = document.getElementById('qatarIdSection');
                const passportSection = document.getElementById('passportSection');
                
                if (e.target.value === 'yes') {
                    qatarIdSection.style.display = 'block';
                    passportSection.style.display = 'none';
                } else {
                    qatarIdSection.style.display = 'none';
                    passportSection.style.display = 'block';
                }
            }
        });
        
        // Handle file uploads
        document.addEventListener('change', function(e) {
            if (e.target.type === 'file') {
                const fileInput = e.target;
                const fileInfo = document.getElementById(fileInput.id + '-info');
                const uploadDiv = fileInput.closest('.file-upload');
                
                if (fileInput.files.length > 0) {
                    const fileName = fileInput.files[0].name;
                    const fileSize = (fileInput.files[0].size / 1024 / 1024).toFixed(2);
                    
                    if (fileInfo) {
                        fileInfo.textContent = `‚úÖ ${fileName} (${fileSize} MB)`;
                        fileInfo.style.display = 'block';
                    }
                    
                    if (uploadDiv) {
                        uploadDiv.classList.add('has-file');
                    }
                } else {
                    if (fileInfo) {
                        fileInfo.style.display = 'none';
                    }
                    
                    if (uploadDiv) {
                        uploadDiv.classList.remove('has-file');
                    }
                }
            }
        });
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            showStep(1);
        });
    </script>
</body>
</html>
